language: ruby
os: linux
dist: focal

arch:
  - amd64
  - arm64

rvm:
  - 2.7
  - 3.0
  - 3.1
  - ruby-head
  - truffleruby

before_script:
  - sudo apt install -y icu-devtools g++
  - sudo chmod +x build_icu.sh
  - sudo $PWD/build_icu.sh versions
  - sudo $PWD/build_icu.sh install 71.1
  - export LD_LIBRARY_PATH=/usr/local/lib
  - icuinfo
  - yes | gem update --system --force
  - gem install bundler

jobs:
  allow_failures:
    - rvm: truffleruby
